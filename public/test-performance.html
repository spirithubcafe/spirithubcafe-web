<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تست سرعت سرویس‌های JSON</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .loading { animation: pulse 2s infinite; }
    </style>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">
            🚀 تست سرعت سرویس‌های JSON
        </h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">📊 نتایج تست سرعت</h2>
            <div id="results" class="space-y-4">
                <div class="text-gray-600">در حال بارگیری...</div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">📋 جزئیات تنظیمات</h2>
            <div id="details" class="space-y-4">
                <div class="text-gray-600">در حال بارگیری جزئیات...</div>
            </div>
        </div>
    </div>

    <script type="module">
        // تست سرعت بارگیری تنظیمات
        async function testPerformance() {
            const results = document.getElementById('results');
            const details = document.getElementById('details');
            
            results.innerHTML = '<div class="loading text-blue-600">⏳ در حال تست...</div>';
            
            const testResults = [];
            const settingsData = {};

            // لیست فایل‌های JSON برای تست
            const jsonFiles = [
                { name: 'Hero Slides', file: 'hero-slides.json' },
                { name: 'Hero Settings', file: 'hero-settings.json' },
                { name: 'Footer Settings', file: 'footer-settings.json' },
                { name: 'Categories Settings', file: 'categories-settings.json' },
                { name: 'Homepage Settings', file: 'homepage-settings.json' },
                { name: 'Newsletter Settings', file: 'newsletter-settings.json' },
                { name: 'Contact Settings', file: 'contact-settings.json' },
                { name: 'Aramex Settings', file: 'aramex-settings.json' }
            ];

            // تست بارگیری هر فایل
            for (const { name, file } of jsonFiles) {
                const startTime = performance.now();
                try {
                    const response = await fetch(\`/data/\${file}\`);
                    const data = await response.json();
                    const endTime = performance.now();
                    const loadTime = endTime - startTime;

                    testResults.push({
                        name,
                        loadTime: loadTime.toFixed(2),
                        size: JSON.stringify(data).length,
                        success: true
                    });

                    settingsData[name] = data;
                } catch (error) {
                    const endTime = performance.now();
                    const loadTime = endTime - startTime;
                    
                    testResults.push({
                        name,
                        loadTime: loadTime.toFixed(2),
                        error: error.message,
                        success: false
                    });
                }
            }

            // محاسبه آمار کلی
            const successfulTests = testResults.filter(r => r.success);
            const totalTime = successfulTests.reduce((sum, r) => sum + parseFloat(r.loadTime), 0);
            const avgTime = successfulTests.length > 0 ? (totalTime / successfulTests.length).toFixed(2) : 0;
            const totalSize = successfulTests.reduce((sum, r) => sum + r.size, 0);

            // نمایش نتایج
            results.innerHTML = \`
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-green-600">\${successfulTests.length}</div>
                        <div class="text-sm text-green-700">فایل موفق</div>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-blue-600">\${avgTime}ms</div>
                        <div class="text-sm text-blue-700">میانگین سرعت</div>
                    </div>
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-purple-600">\${totalTime.toFixed(2)}ms</div>
                        <div class="text-sm text-purple-700">زمان کل</div>
                    </div>
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-orange-600">\${(totalSize / 1024).toFixed(1)}KB</div>
                        <div class="text-sm text-orange-700">حجم کل</div>
                    </div>
                </div>
                <div class="space-y-2">
                    \${testResults.map(result => \`
                        <div class="flex items-center justify-between p-3 border rounded-lg \${result.success ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}">
                            <span class="font-medium">\${result.name}</span>
                            <div class="text-right">
                                \${result.success 
                                    ? \`<span class="text-green-600 font-mono">\${result.loadTime}ms</span> <span class="text-gray-500 text-sm">(\${(result.size / 1024).toFixed(1)}KB)</span>\`
                                    : \`<span class="text-red-600 text-sm">\${result.error}</span>\`
                                }
                            </div>
                        </div>
                    \`).join('')}
                </div>
            \`;

            // نمایش جزئیات
            details.innerHTML = \`
                <div class="space-y-4">
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <h3 class="font-semibold text-gray-800 mb-2">📈 مزایای سیستم JSON:</h3>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>سرعت بالا: بدون نیاز به اتصال دیتابیس</li>
                            <li>کش محلی: ذخیره سازی در localStorage</li>
                            <li>عملکرد آفلاین: کار بدون اینترنت</li>
                            <li>استقرار آسان: فایل‌های استاتیک</li>
                            <li>کاهش هزینه: بدون query های دیتابیس</li>
                        </ul>
                    </div>
                    \${Object.entries(settingsData).map(([name, data]) => \`
                        <details class="border border-gray-200 rounded-lg">
                            <summary class="p-3 font-medium cursor-pointer hover:bg-gray-50">\${name} - جزئیات</summary>
                            <div class="p-3 border-t border-gray-200 bg-gray-50">
                                <pre class="text-xs text-gray-600 overflow-auto max-h-40">\${JSON.stringify(data, null, 2).substring(0, 500)}...\${JSON.stringify(data).length > 500 ? '\\n[بقیه محتوا...]' : ''}</pre>
                            </div>
                        </details>
                    \`).join('')}
                </div>
            \`;
        }

        // اجرای تست
        testPerformance();
    </script>
</body>
</html>
